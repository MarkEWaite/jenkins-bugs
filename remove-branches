#!/bin/sh

# Remove remote and local branches which include "JENKINS-37727-" in
# their name

if ! git config --get-all remote.origin.fetch | grep -F has-slash; then
    git config --add remote.origin.fetch '+refs/heads/has-slash/*:refs/remotes/origin/has-slash/*'
    git fetch origin
fi

for branch in $(git branch | grep -F JENKINS-37727-); do
    echo Removing local branch: $branch
    git branch -D $branch
done

git fetch --all --prune

for remote in $(git remote | sort -r); do
    for remote_branch in $(git branch -a | grep $remote.*JENKINS-37727-); do
        branch=$(echo $remote_branch | sed "s!remotes/$remote/!!g")
        echo Removing remote branch: $branch from $remote
        git push $remote :$branch
    done
done
